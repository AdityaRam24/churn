trigger:
  branches:
    include:
      - main

pr:
  branches:
    include:
      - main

pool:
  name: Default    # your selfâ€‘hosted agent pool

variables:
  # image settings
  name: customer-churn-prediction
  repo: adityaram24/$(name)
  registry: docker-hub-connection

  # Dockerfile & context
  path: CustomerChurn/Customer-Churn-Prediction
  file: $(path)/Dockerfile

  # unique build tag
  tag: $(Build.SourceBranchName)-$(Build.BuildId)

steps:
  - checkout: self
    clean: true
    fetchDepth: 1
    persistCredentials: true

  - task: Docker@2
    displayName: Build & Push $(repo)
    timeoutInMinutes: 10
    inputs:
      command: buildAndPush
      containerRegistry: $(registry)
      repository: $(repo)
      dockerfile: $(file)
      buildContext: $(path)
      tags: |
        $(tag)
        latest
      cacheFrom: type=registry,ref=$(registry)/$(repo):cache
      cacheTo: type=registry,ref=$(registry)/$(repo):cache,mode=max
